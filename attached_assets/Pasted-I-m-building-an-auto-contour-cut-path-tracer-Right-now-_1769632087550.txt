I’m building an auto contour-cut path tracer. Right now the alpha-trace/smoothing step is rounding sharp geometric corners that should stay crisp. I need “selective corner preservation” like Flexi RIP/CorelDRAW: preserve only true geometric corners (rectangle/triangle-like) while still smoothing small noisy edge variations from artwork.

Goal:
- Preserve sharp corners only when they come from long straight edges intersecting (e.g., badge/shield corners).
- Do NOT preserve tiny corners created by texture, watercolor edges, flowers, hair, grunge, or pixel noise.
- For preserved corners: output two straight segments meeting at the corner (no rounding / no bezier handle across the corner).
- Everywhere else: keep smoothing/rounding as currently.

Implementation requirements (algorithm spec):
1) Work on the traced contour polyline (after thresholding/alpha extraction). Before curve fitting, detect corners on the polyline.
2) A corner must satisfy BOTH:
   A) Angle condition: the internal angle at vertex i is sharp enough (e.g., angle < 120°; tune 100–140).
   B) Scale/arm-length condition: the “support” length on BOTH sides is large enough (prevents tiny noisy corners).
      - Compute armLenPrev = distance(p[i], p[i-k]) and armLenNext = distance(p[i], p[i+k]) along the polyline for some k or for an arc-length window.
      - Require min(armLenPrev, armLenNext) > ARM_THRESH (e.g., 12–30 px depending on resolution).
3) Optional stability: require the sharpness persists in a small neighborhood (avoid single-point spikes):
   - angle(i) is a local minimum OR angle(i) < angle(i-1) and angle(i) < angle(i+1)
4) Once corners are flagged, apply curve fitting/smoothing with CORNER PROTECTION:
   - For points within protectRadiusPx (e.g., 8–20 px) of a preserved corner, disable smoothing / force straight lines.
   - Split the polyline at preserved corners into segments.
   - Fit curves only within segments, but keep the corner vertices fixed and connect segments with straight lines at the corner.
5) Important: do NOT globally reduce smoothing; only gate smoothing near preserved corners. This keeps organic designs smooth and avoids “sharp everywhere.”

Please implement:
- computeAngle(p[i-k], p[i], p[i+k])
- computeArmLengths based on arc-length window
- detectPreservedCorners(angle < ANGLE_THRESH && armLen > ARM_THRESH)
- modify the smoothing/curve-fit stage so preserved corners remain cusps (two lines intersect, no rounding).

Provide default starting params:
ANGLE_THRESH ~ 120°
ARM_THRESH ~ 20px (scale with DPI)
protectRadiusPx ~ 15px
and expose them as tunables.